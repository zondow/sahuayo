<?php
$arrayPreguntas = array(
    /*Ambiente fisico*/
    array("num" => 1, "pregunta" => "El espacio para desarrollar mi trabajo es el adecuado?", "field" => "eva_AmFi1"),
    array("num" => 2, "pregunta" => "Hay una adecuada ventilación e iluminación en mi área de trabajo?", "field" => "eva_AmFi2"),
    array("num" => 3, "pregunta" => "El mobiliario, herramientas y equipo  de trabajo son los adecuados y funcionales para realizar mi trabajo?", "field" => "eva_AmFi3"),
    array("num" => 4, "pregunta" => "La Caja me capacita para prevenir accidentes?", "field" => "eva_AmFi4"),
    /*Formacion y capacitacion*/
    array("num" => 5, "pregunta" => "Conozco la capacitación que se me proporcionará en el transcurso del año?", "field" => "eva_FoCa1"),
    array("num" => 6, "pregunta" => "La Caja me da facilidades para capacitarme?", "field" => "eva_FoCa2"),
    array("num" => 7, "pregunta" => "Recibo capacitación para actualizar los conocimientos de mi trabajo?", "field" => "eva_FoCa3"),
    array("num" => 8, "pregunta" => "Creo que tengo la oportunidad de desarrollarme profesionalmente en la organización?", "field" => "eva_FoCa4"),
    array("num" => 9, "pregunta" => "Conozco claramente cuáles son mis funciones y responsabilidades?", "field" => "eva_FoCa5"),
    array("num" => 10, "pregunta" => "Cuando necesito información se donde consultarla?", "field" => "eva_FoCa6"),
    array("num" => 11, "pregunta" => "Conozco las políticas y la forma de trabajo de mi departamento?", "field" => "eva_FoCa7"),
    /*Liderazgo*/
    array("num" => 12, "pregunta" => "Mi jefe valora mis ideas, opiniones, sugerencias y las toma en cuenta?", "field" => "eva_Lid1"),
    array("num" => 13, "pregunta" => "La orientación que me da mi jefe me ayuda a realizar mejor mi trabajo?", "field" => "eva_Lid2"),
    array("num" => 14, "pregunta" => "Mi jefe tiene platicas conmigo para comentarme sobre mis áreas de oportunidad con el fin de mejorar?", "field" => "eva_Lid3"),
    array("num" => 15, "pregunta" => "Mi jefe demuestra un dominio y conocimiento de sus funciones?", "field" => "eva_Lid4"),
    array("num" => 16, "pregunta" => "Mi jefe es coherente con lo que dice y hace?", "field" => "eva_Lid5"),
    array("num" => 17, "pregunta" => "Mi jefe se preocupa por mi bienestar y las necesidades que tengo?", "field" => "eva_Lid6"),
    array("num" => 18, "pregunta" => "Mi jefe tiene disposicion cuando lo requiero?", "field" => "eva_Lid7"),
    array("num" => 19, "pregunta" => "Mi jefe se preocupa por mantener un buen clima en el equipo?", "field" => "eva_Lid8"),
    array("num" => 20, "pregunta" => "Mi jefe me felicita o reconoce cuando realizo bien mi trabajo?", "field" => "eva_Lid9"),
    array("num" => 21, "pregunta" => "En mi departamento o sucursal se da un trato justo y equitativo a todos los empleados?", "field" => "eva_Lid10"),
    array("num" => 22, "pregunta" => "Mi jefe es claro y específico al definir los objetivos del trabajo o del departamento?", "field" => "eva_Lid11"),
    /*relaciones en el trabajo*/
    array("num" => 23, "pregunta" => "Puedo confiar en mis compañeros de trabajo?", "field" => "eva_ReTra1"),
    array("num" => 24, "pregunta" => "En mi departamento o sucursal se fomenta el compañerismo y la unión entre los colaboradores?", "field" => "eva_ReTra2"),
    array("num" => 25, "pregunta" => "La relación con mi jefe es cordial y respetuosa?", "field" => "eva_ReTra3"),
    array("num" => 26, "pregunta" => "Recibo buen trato por parte de mis compañeros de la caja?", "field" => "eva_ReTra4"),
    array("num" => 27, "pregunta" => "Tengo la confianza de acercarme a mi jefe directo para preguntar sobre algo que no tengo claro?", "field" => "eva_ReTra5"),
    array("num" => 28, "pregunta" => "Recibo apoyo por parte de mis compañeros de trabajo si enfrento problemas para desarrollar mi trabajo?", "field" => "eva_ReTra6"),
    array("num" => 29, "pregunta" => "Considero que existe un buen ambiente de trabajo?", "field" => "eva_ReTra7"),
    array("num" => 30, "pregunta" => "Las personas con las que me relaciono en la organización actúan con respeto y de manera ética?", "field" => "eva_ReTra8"),
    array("num" => 31, "pregunta" => "Me siento parte de mi equipo de trabajo?", "field" => "eva_ReTra9"),
    array("num" => 32, "pregunta" => "Cuando hay mucho trabajo nos apoyamos en las actividades para terminarlas a tiempo?", "field" => "eva_ReTra10"),
    /*sentido de pertenencia*/
    array("num" => 33, "pregunta" => "Conozco cuál es el objetivo de la Caja y trabajo con base a ello para poder lograrlo?", "field" => "eva_SenPer1"),
    array("num" => 34, "pregunta" => "Me involucro en las actividades de la Caja?", "field" => "eva_SenPer2"),
    array("num" => 35, "pregunta" => "Me identifico con la misión, la vision y los valores de la Caja?", "field" => "eva_SenPer3"),
    array("num" => 36, "pregunta" => "En mi departamento o sucursal se actúa conforme a los valores de la Caja?", "field" => "eva_SenPer4"),
    array("num" => 37, "pregunta" => "Me siento comprometido(a) con mi trabajo para lograr el objetivo de la Caja?", "field" => "eva_SenPer5"),
    array("num" => 38, "pregunta" => "Pienso que la organización es un buen lugar para trabajar y me gustaría continuar trabajando aquí?", "field" => "eva_SenPer6"),
    array("num" => 39, "pregunta" => "Me siento orgulloso(a) de trabajar para la organización?", "field" => "eva_SenPer7"),
    /*satisfaccion laboral*/
    array("num" => 40, "pregunta" => "Estoy satisfecho(a) con el desempeño de mi trabajo?", "field" => "eva_SatLab1"),
    array("num" => 41, "pregunta" => "Estoy satisfecho(a) con el puesto que tengo actualmente?", "field" => "eva_SatLab2"),
    array("num" => 42, "pregunta" => "Es interesante el trabajo que desempeño en la Caja?", "field" => "eva_SatLab3"),
    array("num" => 43, "pregunta" => "Mi trabajo me ofrece retos y la oportunidad de seguir mejorando?", "field" => "eva_SatLab4"),
    array("num" => 44, "pregunta" => "La caja me proporciona oportunidades de crecimiento económico y profesional?", "field" => "eva_SatLab5"),
    array("num" => 45, "pregunta" => "Mi capacidad profesional está de acuerdo a las tareas y responsabilidades asignadas?", "field" => "eva_SatLab6"),
    array("num" => 46, "pregunta" => "Siento que la organización me valora?", "field" => "eva_SatLab7"),
    array("num" => 47, "pregunta" => "Desde mi ingreso  pienso que la Caja se ha ido transformando en un mejor lugar para trabajar?", "field" => "eva_SatLab8"),
    array("num" => 48, "pregunta" => "Considero que mi sueldo está bien remunerado?", "field" => "eva_SatLab9"),
    /*comunicacion*/
    array("num" => 49, "pregunta" => "Conozco los canales de comunicación de la Caja?", "field" => "eva_Com1"),
    array("num" => 50, "pregunta" => "La comunicación interna dentro de mi departamento o sucursal funciona correctamente?", "field" => "eva_Com2"),
    array("num" => 51, "pregunta" => "Mi departamento o sucursal se reúnen por lo menos una vez al mes para ver avances en las metas y objetivos?", "field" => "eva_Com3"),
    array("num" => 52, "pregunta" => "La comunicación sobre los resultados y marcha de la compañía es clara y transparente?", "field" => "eva_Com4"),
    array("num" => 53, "pregunta" => "Los comunicados internos me proporcionan información útil?", "field" => "eva_Com5"),
    array("num" => 54, "pregunta" => "Se me comunica  de forma oportuna la información que requiero para mi trabajo?", "field" => "eva_Com6"),
    array("num" => 55, "pregunta" => "Estoy enterado(a) de situaciones y cambios de la Caja a través de mi jefe?", "field" => "eva_Com7"),
    array("num" => 56, "pregunta" => "Se me comunica  de forma oportuna la información de los servicios y promociones de la Caja?", "field" => "eva_Com8"),
);

?>
<style>
    .my-custom-scrollbar {
        position: relative;
        height: 200px;
        overflow: -moz-scrollbars-vertical;
        overflow-y: scroll;
    }

    .table-wrapper-scroll-y {
        display: block;
    }

    thead th {
        position: sticky;
        top: 0;
    }
</style>
<div class="row">
    <div class="col-12">
        <div class="card-box">
            <h4 class="header-title">Configuración</h4>
            <p class="sub-header">Seleccione un rango de fechas para calcular los resultados.</p>

            <div class="row">
                <div class="col-12">
                    <form method="post" action="<?= base_url("Evaluaciones/resultadosClimaLaboral") ?>" class="form-horizontal" autocomplete="off">
                        <div class="form-group row">
                            <label class="col-3 col-form-label"> * Periodo: </label>
                            <div class="col-9">
                                <div class="input-daterange input-group" id="date-range">
                                    <input type="text" class="form-control" name="fechaInicio" placeholder=" -- Seleccione inicio --" required>
                                    <input type="text" class="form-control" id="fechaFin" name="fechaFin" placeholder=" -- Seleccione fin --" required>
                                </div>
                                <input id="txtF1" type="text" class="form-control" id="f1" value="<?= isset($f1) ? $f1 : "0000-00-00" ?>" hidden>
                                <input id="txtF2" type="text" class="form-control" id="f2" value="<?= isset($f2) ? $f2 : "0000-00-00" ?>" hidden>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-3 col-form-label"> * Sucursal: </label>
                            <div class="col-9">
                                <div class="input-daterange input-group" id="date-range">
                                    <select id="sucursal" name="sucursal" class="select2 form-control ">
                                        <option value="0">TODAS</option>
                                        <?php foreach($sucursales as $s){
                                            echo '<option value="'.encryptDecrypt('encrypt',$s['suc_SucursalID']).'">'.$s['suc_Sucursal'].'</option>';
                                        } ?>
                                    </select>
                                </div>
                                <input type="text" class="form-control" id="suc" value="<?= isset($sucursal) ? $sucursal : "0" ?>" hidden>
                            </div>
                        </div>
                        <div class="form-group mb-0 justify-content-end row">
                            <div class="col-9">
                                <button type="submit" class="btn btn-success waves-effect waves-light">Consultar</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<?php if (isset($result)) { ?>

    <div class="row">
        <div class="col-12 survey-app ">
            <div class="tab-content mb-1">
                <div class="tab-pane show active" id="third" role="tabpanel" aria-labelledby="third-tab">
                    <div class="row">
                        <div class="col-12 col-lg-12">
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h4 class="mb-4 text-center"><strong>Resultados Globales del periodo de evaluación del<br><?= longDate($f1, ' de ') ?> al <?= longDate($f2, ' de ') ?></strong></h3>
                                        <div style="padding-bottom: 3em;">
                                            <canvas id="cle_TotalEmpresa"></canvas>
                                        </div>
                                        <h4>
                                            <b id="prom"></b>

                                            <a href="<?= base_url("PDF/reporteClimaLaboral/" . $f1 . "/" . $f2."/".$sucursal) ?>" class="btn btn-warning show-pdf" style="color: white" data-title="Resultados evaluación Clima Laboral"><b class="dripicons-print"></b> Imprimir resultados</a>
                                        </h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <div class="card question d-flex mb-2 view-question">
                <br>
                <h3 class="mb-2 text-center"><strong>Resultados Específicos</strong></h3>

                <div class="d-flex flex-grow-1 min-width-zero">
                    <div class="card-body align-self-center d-flex flex-column flex-md-row justify-content-between min-width-zero align-items-md-center text-center">
                        <h4 class="list-item-heading text-dark" align="center" style="color: #212940; ">AMBIENTE FÍSICO</h4>
                    </div>
                </div>

                <div class="question-collapse collapse show text-center" style="padding-bottom: 3em" id="qInteraccionS">
                    <div class="row">
                        <?php for ($i = 0; $i <= 3; $i++) { ?>
                            <div class="col-4">
                                <!---->
                                <h6 class="mb-2">
                                    <span class="heading-number d-inline-block"><?= $arrayPreguntas[$i]['num'] ?>. </span> <?= $arrayPreguntas[$i]['pregunta'] ?>
                                </h6>
                                <div class="dashboard-donut-chart">
                                    <?php
                                    $dataP = array();
                                    $resultP = db()->query("SELECT CLI." . $arrayPreguntas[$i]['field'] . " FROM evaluacionclimalaboral CLI")->getResultArray();
                                    $valoresP = array_count_values(array_column($resultP, $arrayPreguntas[$i]['field']));
                                    (isset($valoresP[1])) ? array_push($dataP, $valoresP[1]) : array_push($dataP, 0);
                                    (isset($valoresP[2])) ? array_push($dataP, $valoresP[2]) : array_push($dataP, 0);
                                    (isset($valoresP[3])) ? array_push($dataP, $valoresP[3]) : array_push($dataP, 0);
                                    (isset($valoresP[4])) ? array_push($dataP, $valoresP[4]) : array_push($dataP, 0);
                                    (isset($valoresP[5])) ? array_push($dataP, $valoresP[5]) : array_push($dataP, 0);
                                    $dataR[$arrayPreguntas[$i]['field']] = $dataP;
                                    ?>
                                    <canvas style="height: 270px" id="<?= $arrayPreguntas[$i]['field'] ?>"></canvas>
                                </div>
                            </div>

                        <?php } ?>
                    </div>
                </div>
            </div>

            <div class="card question d-flex mb-2 view-question">
                <div class="d-flex flex-grow-1 min-width-zero">
                    <div class="card-body align-self-center d-flex flex-column flex-md-row justify-content-between min-width-zero align-items-md-center text-center">
                        <h4 class="text-dark" align="center" style="color: #212940; ">FORMACIÓN Y CAPACITACIÓN</h4>
                    </div>

                </div>
                <div class="question-collapse collapse show text-center" style="padding-bottom: 3em" id="qComunicacion">
                    <div class="row">
                        <?php for ($i = 4; $i <= 10; $i++) { ?>
                            <div class="col-4">

                                <h6 class="mb-2">
                                    <span class="heading-number d-inline-block"><?= $arrayPreguntas[$i]['num'] ?>. </span> <?= $arrayPreguntas[$i]['pregunta'] ?>
                                </h6>
                                <div class="dashboard-donut-chart">
                                    <?php
                                    $dataP = array();
                                    $resultP = db()->query("SELECT CLI." . $arrayPreguntas[$i]['field'] . " FROM evaluacionclimalaboral CLI")->getResultArray();
                                    $valoresP = array_count_values(array_column($resultP, $arrayPreguntas[$i]['field']));
                                    (isset($valoresP[1])) ? array_push($dataP, $valoresP[1]) : array_push($dataP, 0);
                                    (isset($valoresP[2])) ? array_push($dataP, $valoresP[2]) : array_push($dataP, 0);
                                    (isset($valoresP[3])) ? array_push($dataP, $valoresP[3]) : array_push($dataP, 0);
                                    (isset($valoresP[4])) ? array_push($dataP, $valoresP[4]) : array_push($dataP, 0);
                                    (isset($valoresP[5])) ? array_push($dataP, $valoresP[5]) : array_push($dataP, 0);
                                    $dataR[$arrayPreguntas[$i]['field']] = $dataP;
                                    ?>
                                    <canvas id="<?= $arrayPreguntas[$i]['field'] ?>" style="height: 270px"></canvas>
                                </div>
                            </div>
                        <?php } ?>
                    </div>
                </div>
            </div>

            <div class="card question d-flex mb-2 view-question">
                <div class="d-flex flex-grow-1 min-width-zero">
                    <div class="card-body align-self-center d-flex flex-column flex-md-row justify-content-between min-width-zero align-items-md-center text-center">
                        <h4 class="text-dark" align="center" style="color: #212940; ">LIDERAZGO</h4>
                    </div>
                </div>
                <div class="question-collapse collapse show text-center" style="padding-bottom: 3em" id="qCondiciones">
                    <div class="row">
                        <?php for ($i = 11; $i <= 21; $i++) { ?>

                            <div class="col-4">

                                <h6 class="mb-2">
                                    <span class="heading-number d-inline-block"><?= $arrayPreguntas[$i]['num'] ?>. </span> <?= $arrayPreguntas[$i]['pregunta'] ?>
                                </h6>
                                <div class="dashboard-donut-chart">
                                    <?php
                                    $dataP = array();
                                    $resultP = db()->query("SELECT CLI." . $arrayPreguntas[$i]['field'] . " FROM evaluacionclimalaboral CLI")->getResultArray();
                                    $valoresP = array_count_values(array_column($resultP, $arrayPreguntas[$i]['field']));
                                    (isset($valoresP[1])) ? array_push($dataP, $valoresP[1]) : array_push($dataP, 0);
                                    (isset($valoresP[2])) ? array_push($dataP, $valoresP[2]) : array_push($dataP, 0);
                                    (isset($valoresP[3])) ? array_push($dataP, $valoresP[3]) : array_push($dataP, 0);
                                    (isset($valoresP[4])) ? array_push($dataP, $valoresP[4]) : array_push($dataP, 0);
                                    (isset($valoresP[5])) ? array_push($dataP, $valoresP[5]) : array_push($dataP, 0);
                                    $dataR[$arrayPreguntas[$i]['field']] = $dataP;
                                    ?>
                                    <canvas id="<?= $arrayPreguntas[$i]['field'] ?>" style="height: 270px"></canvas>
                                </div>
                            </div>
                        <?php } ?>
                    </div>
                </div>
            </div>

            <div class="card question d-flex mb-2 view-question">
                <div class="d-flex flex-grow-1 min-width-zero">
                    <div class="card-body align-self-center d-flex flex-column flex-md-row justify-content-between min-width-zero align-items-md-center text-center">
                        <h4 class="text-dark" align="center" style="color: #212940; ">RELACIONES EN EL TRABAJO</h4>
                    </div>
                </div>
                <div class="question-collapse collapse show text-center" style="padding-bottom: 3em" id="qReco">
                    <div class="row">
                        <?php for ($i = 22; $i <= 31; $i++) { ?>

                            <div class="col-4">
                                <h6 class="mb-2">
                                    <span class="heading-number d-inline-block"><?= $arrayPreguntas[$i]['num'] ?>. </span> <?= $arrayPreguntas[$i]['pregunta'] ?>
                                </h6>
                                <div class="dashboard-donut-chart">
                                    <?php
                                    $dataP = array();
                                    $resultP = db()->query("SELECT CLI." . $arrayPreguntas[$i]['field'] . " FROM evaluacionclimalaboral CLI")->getResultArray();
                                    $valoresP = array_count_values(array_column($resultP, $arrayPreguntas[$i]['field']));
                                    (isset($valoresP[1])) ? array_push($dataP, $valoresP[1]) : array_push($dataP, 0);
                                    (isset($valoresP[2])) ? array_push($dataP, $valoresP[2]) : array_push($dataP, 0);
                                    (isset($valoresP[3])) ? array_push($dataP, $valoresP[3]) : array_push($dataP, 0);
                                    (isset($valoresP[4])) ? array_push($dataP, $valoresP[4]) : array_push($dataP, 0);
                                    (isset($valoresP[5])) ? array_push($dataP, $valoresP[5]) : array_push($dataP, 0);
                                    $dataR[$arrayPreguntas[$i]['field']] = $dataP;
                                    ?>
                                    <canvas id="<?= $arrayPreguntas[$i]['field'] ?>" style="height: 270px"></canvas>
                                </div>
                            </div>
                        <?php } ?>
                    </div>
                </div>
            </div>

            <div class="card question d-flex mb-2 view-question">
                <div class="d-flex flex-grow-1 min-width-zero">
                    <div class="card-body align-self-center d-flex flex-column flex-md-row justify-content-between min-width-zero align-items-md-center text-center">
                        <h4 class="text-dark" align="center" style="color: #212940; ">SENTIDO DE PERTENENCIA</h4>
                    </div>
                </div>
                <div class="question-collapse collapse show text-center" style="padding-bottom: 3em" id="qRemuneracion">
                    <div class="row">

                        <?php for ($i = 32; $i <= 38; $i++) { ?>

                            <div class="col-4">
                                <h6 class="mb-2">
                                    <span class="heading-number d-inline-block"><?= $arrayPreguntas[$i]['num'] ?>. </span> <?= $arrayPreguntas[$i]['pregunta'] ?>
                                </h6>
                                <div class="dashboard-donut-chart">
                                    <?php
                                    $dataP = array();
                                    $resultP = db()->query("SELECT CLI." . $arrayPreguntas[$i]['field'] . " FROM evaluacionclimalaboral CLI")->getResultArray();
                                    $valoresP = array_count_values(array_column($resultP, $arrayPreguntas[$i]['field']));
                                    (isset($valoresP[1])) ? array_push($dataP, $valoresP[1]) : array_push($dataP, 0);
                                    (isset($valoresP[2])) ? array_push($dataP, $valoresP[2]) : array_push($dataP, 0);
                                    (isset($valoresP[3])) ? array_push($dataP, $valoresP[3]) : array_push($dataP, 0);
                                    (isset($valoresP[4])) ? array_push($dataP, $valoresP[4]) : array_push($dataP, 0);
                                    (isset($valoresP[5])) ? array_push($dataP, $valoresP[5]) : array_push($dataP, 0);
                                    $dataR[$arrayPreguntas[$i]['field']] = $dataP;
                                    ?>
                                    <canvas id="<?= $arrayPreguntas[$i]['field'] ?>" style="height: 270px"></canvas>
                                </div>
                            </div>
                        <?php } ?>
                    </div>
                </div>
            </div>

            <div class="card question d-flex mb-2 view-question">
                <div class="d-flex flex-grow-1 min-width-zero">
                    <div class="card-body align-self-center d-flex flex-column flex-md-row justify-content-between min-width-zero align-items-md-center text-center">
                        <h4 class="text-dark" align="center" style="color: #212940; ">SATISFACCIÓN LABORAL</h4>
                    </div>
                </div>
                <div class="question-collapse collapse show text-center" style="padding-bottom: 3em" id="qFormacion">
                    <div class="row">

                        <?php for ($i = 39; $i <= 47; $i++) { ?>

                            <div class="col-4">
                                <h6 class="mb-2">
                                    <span class="heading-number d-inline-block"><?= $arrayPreguntas[$i]['num'] ?>. </span> <?= $arrayPreguntas[$i]['pregunta'] ?>
                                </h6>
                                <div class="dashboard-donut-chart">
                                    <?php
                                    $dataP = array();
                                    $resultP = db()->query("SELECT CLI." . $arrayPreguntas[$i]['field'] . " FROM evaluacionclimalaboral CLI")->getResultArray();
                                    $valoresP = array_count_values(array_column($resultP, $arrayPreguntas[$i]['field']));
                                    (isset($valoresP[1])) ? array_push($dataP, $valoresP[1]) : array_push($dataP, 0);
                                    (isset($valoresP[2])) ? array_push($dataP, $valoresP[2]) : array_push($dataP, 0);
                                    (isset($valoresP[3])) ? array_push($dataP, $valoresP[3]) : array_push($dataP, 0);
                                    (isset($valoresP[4])) ? array_push($dataP, $valoresP[4]) : array_push($dataP, 0);
                                    (isset($valoresP[5])) ? array_push($dataP, $valoresP[5]) : array_push($dataP, 0);
                                    $dataR[$arrayPreguntas[$i]['field']] = $dataP;
                                    ?>
                                    <canvas id="<?= $arrayPreguntas[$i]['field'] ?>" style="height: 270px"></canvas>
                                </div>
                            </div>
                        <?php } ?>
                    </div>
                </div>
            </div>

            <div class="card question d-flex mb-2 view-question">
                <div class="d-flex flex-grow-1 min-width-zero">
                    <div class="card-body align-self-center d-flex flex-column flex-md-row justify-content-between min-width-zero align-items-md-center text-center">
                        <h4 class="text-dark" align="center" style="color: #212940; ">COMUNICACIÓN</h4>
                    </div>
                </div>
                <div class="question-collapse collapse show text-center" style="padding-bottom: 3em" id="qInnovacion">
                    <div class="row">

                        <?php for ($i = 48; $i <= 55; $i++) { ?>

                            <div class="col-4">
                                <h6 class="mb-2">
                                    <span class="heading-number d-inline-block"><?= $arrayPreguntas[$i]['num'] ?>. </span> <?= $arrayPreguntas[$i]['pregunta'] ?>
                                </h6>
                                <div class="dashboard-donut-chart">
                                    <?php
                                    $dataP = array();
                                    $resultP = db()->query("SELECT CLI." . $arrayPreguntas[$i]['field'] . " FROM evaluacionclimalaboral CLI")->getResultArray();
                                    $valoresP = array_count_values(array_column($resultP, $arrayPreguntas[$i]['field']));
                                    (isset($valoresP[1])) ? array_push($dataP, $valoresP[1]) : array_push($dataP, 0);
                                    (isset($valoresP[2])) ? array_push($dataP, $valoresP[2]) : array_push($dataP, 0);
                                    (isset($valoresP[3])) ? array_push($dataP, $valoresP[3]) : array_push($dataP, 0);
                                    (isset($valoresP[4])) ? array_push($dataP, $valoresP[4]) : array_push($dataP, 0);
                                    (isset($valoresP[5])) ? array_push($dataP, $valoresP[5]) : array_push($dataP, 0);
                                    $dataR[$arrayPreguntas[$i]['field']] = $dataP;
                                    ?>
                                    <canvas id="<?= $arrayPreguntas[$i]['field'] ?>" style="height: 270px"></canvas>
                                </div>
                            </div>
                        <?php } ?>
                    </div>
                </div>
            </div>

        </div>

    </div>

<?php } ?>
<script src="<?= base_url("assets/js/Chart.bundle.min.js") ?>"></script>

<script>
    $(document).ready(function() {
        $("#date-range").datepicker({
            daysOfWeekDisabled: [0],
            format: "yyyy-mm-dd",
            toggleActive: !0,
            todayHighlight: true,
            autoclose: true,
        }).on('changeDate', function(e) {
            $("#fechaFin").focus();
        });
    });
    <?php if (isset($result)) { ?>
        $(document).ready(function() {
            $("#btnpdf").hide();
            var centerTextPlugin = {
                afterDatasetsUpdate: function(chart) {},
                beforeDraw: function(chart) {
                    var width = chart.chartArea.right;
                    var height = chart.chartArea.bottom;
                    var ctx = chart.chart.ctx;
                    ctx.restore();

                    var activeLabel = chart.data.labels[0];
                    var activeValue = chart.data.datasets[0].data[0];
                    var dataset = chart.data.datasets[0];
                    var meta = dataset._meta[Object.keys(dataset._meta)[0]];
                    var total = meta.total;

                    var activePercentage = parseFloat(
                        ((activeValue / total) * 100).toFixed(1)
                    );
                    activePercentage = chart.legend.legendItems[0].hidden ?
                        0 :
                        activePercentage;

                    if (chart.pointAvailable) {
                        activeLabel = chart.data.labels[chart.pointIndex];
                        activeValue =
                            chart.data.datasets[chart.pointDataIndex].data[chart.pointIndex];

                        dataset = chart.data.datasets[chart.pointDataIndex];
                        meta = dataset._meta[Object.keys(dataset._meta)[0]];
                        total = meta.total;
                        activePercentage = parseFloat(
                            ((activeValue / total) * 100).toFixed(1)
                        );
                        activePercentage = chart.legend.legendItems[chart.pointIndex].hidden ?
                            0 :
                            activePercentage;
                    }

                    ctx.font = "36px" + " Nunito, sans-serif";
                    ctx.fillStyle = '#404040';
                    ctx.textBaseline = "middle";

                    var text = activePercentage + "%",
                        textX = Math.round((width - ctx.measureText(text).width) / 2),
                        textY = height / 2;
                    ctx.fillText(text, textX, textY);

                    ctx.font = "14px" + " Nunito, sans-serif";
                    ctx.textBaseline = "middle";

                    var text2 = activeLabel,
                        textX = Math.round((width - ctx.measureText(text2).width) / 2),
                        textY = height / 2 - 30;
                    ctx.fillText(text2, textX, textY);

                    ctx.save();
                },
                beforeEvent: function(chart, event, options) {
                    var firstPoint = chart.getElementAtEvent(event)[0];

                    if (firstPoint) {
                        chart.pointIndex = firstPoint._index;
                        chart.pointDataIndex = firstPoint._datasetIndex;
                        chart.pointAvailable = true;
                    }
                }
            };

            Chart.defaults.DoughnutWithShadow = Chart.defaults.doughnut;
            Chart.controllers.DoughnutWithShadow = Chart.controllers.doughnut.extend({
                draw: function(ease) {
                    Chart.controllers.doughnut.prototype.draw.call(this, ease);
                    let ctx = this.chart.chart.ctx;
                    ctx.save();
                    ctx.shadowColor = "rgba(0,0,0,0.15)";
                    ctx.shadowBlur = 10;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 10;
                    ctx.responsive = true;
                    Chart.controllers.doughnut.prototype.draw.apply(this, arguments);
                    ctx.restore();
                }
            });

            <?php
            $data = array_values($result);
            $js_data = json_encode($data);
            echo "var js_data = " . $js_data . ";";
            ?>
            var ctx = document.getElementById('cle_TotalEmpresa').getContext('2d');
            var chart = new Chart(ctx, {
                // The type of chart we want to create
                type: 'bar',

                // The data for our dataset
                data: {
                    labels: ['Ambiente', 'Formación', 'Liderazgo', 'Relaciones', 'Pertenencia', 'Satisfacción Lab.', 'Comunicación'],
                    datasets: [{
                        label: 'Resultado ',
                        backgroundColor: 'rgb(52,152,219)',

                        data: js_data,
                    }]
                },

                options: {
                    plugins: {
                        datalabels: {
                            display: true
                        }
                    },
                    //maintainAspectRatio: false,

                    scales: {
                        yAxes: [{

                            ticks: {
                                min: 0,
                                max: 100,
                                stepSize: 10,
                            }
                        }],
                    },
                    title: {
                        display: true
                    },
                    layout: {
                        padding: {
                            bottom: 20
                        }
                    },

                    responsive: true,
                }

                /*options: {
                    animation: {
                        duration: 500,
                        easing: "easeOutQuart",
                        onComplete: function() {
                            var ctx = this.chart.ctx;
                            ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontFamily, 'normal', Chart.defaults.global.defaultFontFamily);
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'bottom';

                            this.data.datasets.forEach(function(dataset) {
                                for (var i = 0; i < dataset.data.length; i++) {
                                    var model = dataset._meta[Object.keys(dataset._meta)[0]].data[i]._model,
                                        scale_max = dataset._meta[Object.keys(dataset._meta)[0]].data[i]._yScale.maxHeight;
                                    ctx.fillStyle = '#444';
                                    var y_pos = model.y - 5;
                                    // Make sure data value does not get overflown and hidden
                                    // when the bar's value is too close to max value of scale
                                    // Note: The y value is reverse, it counts from top down
                                    if ((scale_max - model.y) / scale_max >= 0.93)
                                        y_pos = model.y + 20;
                                    ctx.fillText(dataset.data[i], model.x, y_pos);
                                }
                            });
                        }
                    }
                }*/


            });

            //Promedio
            var cont = 0;
            var prom = 0;
            $.each(js_data, function(key, value) {
                prom += parseFloat(value);
                cont++;
            });

            prom = (prom / cont).toFixed(2);

            var clase = '';
            if (prom < 25) {
                clase = 'badge badge-pill badge-dark';
            } else if (prom >= 25 && prom < 50) {
                clase = 'badge badge-pill badge-danger';
            } else if (prom >= 50 && prom < 80) {
                clase = 'badge badge-pill badge-warning';
            } else if (prom >= 80 && prom <= 100) {
                clase = 'badge badge-pill badge-success';
            }

            //$('#prom').html('Promedio:&nbsp&nbsp&nbsp<span class="'+clase+'">'+prom+' %</span>');

            //Preguntas
            var arrayPreguntas;
            <?php echo "arrayPreguntas = " . json_encode($dataR) . ";"; ?>

            arrayPreguntas = JSON.stringify(arrayPreguntas);
            var arrayP = JSON.parse(arrayPreguntas);
            console.log(arrayP);

            for (var pregunta in arrayP) {
                var varP = document.getElementById(pregunta).getContext('2d');
                var chartP = new Chart(varP, {
                    type: 'doughnut',
                    plugins: [centerTextPlugin],
                    data: {
                        datasets: [{
                            data: arrayP[pregunta],
                            borderColor: [
                                'rgb(229, 159, 113)',
                                'rgb(186, 90, 49)',
                                'rgb(48, 153, 116)',
                                'rgb(126, 130, 135)',
                                'rgb(45, 55, 70)'
                            ],
                            backgroundColor: [
                                'rgb(229, 159, 113, 0.48)',
                                'rgb(186, 90, 49, 0.48)',
                                'rgb(48, 153, 116, 0.48)',
                                'rgb(126, 130, 135, 0.48)',
                                'rgb(45, 55, 70, 0.48)'
                            ]
                        }],
                        labels: ['Nunca', 'Casi Nunca', 'A Veces', 'Casi Siempre', 'Siempre']
                    },
                    options: {
                        plugins: {
                            datalabels: {
                                display: true,
                            }
                        },
                        responsive: true,
                        maintainAspectRatio: false,
                        cutoutPercentage: 80,
                        title: {
                            display: false
                        },
                        layout: {
                            padding: {
                                bottom: 20
                            }
                        },
                        legend: {
                            position: "bottom",
                            labels: {
                                padding: 30,
                                usePointStyle: true,
                                fontSize: 12
                            }
                        },
                        tooltips: {
                            enabled: false
                        }
                    }
                });
            }

            setTimeout(function() {
                guardarImagenes();
                $("#btnpdf").show();
            }, 1000);

            //setTimeout(function(){
            //    $("#btnpdf").show();
            //}, 30000);

            //Guardar imagenes Graficas
            function guardarImagenes() {
                var canvasGrafica = document.getElementById('cle_TotalEmpresa');
                var dataGrafica = canvasGrafica.toDataURL('image/png', 1.0);

                var imgs = dataGrafica;

                //Ajax guardar imagen
                $.ajax({
                    url: BASE_URL + '/Evaluaciones/ajax_guardarGraficaClimaLaboral/',
                    type: 'post',
                    cache: false,
                    async: false,
                    data: {
                        img: imgs
                    }
                }).done(function(data) {
                    //console.log("La imagen se guardó correctamente");
                }).fail(function(data) {
                    //console.log("Ocurrió un error de conexión. Por favor recargue la página e intente de nuevo.");
                    //console.log(data);
                }).always(function(e) {}); //Ajax guardar imagen

            }

        });
    <?php } ?>
</script>